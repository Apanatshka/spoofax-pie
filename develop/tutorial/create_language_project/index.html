
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Spoofax 3 documentation website">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>Creating a language project - Spoofax 3</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7CJetBrains+Mono&display=fallback">
        <style>:root{--md-text-font-family:"";--md-code-font-family:"JetBrains Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creating-a-language-project" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Spoofax 3" class="md-header__button md-logo" aria-label="Spoofax 3" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spoofax 3
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Creating a language project
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/metaborg/spoofax-pie/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    metaborg/spoofax-pie
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../install/" class="md-tabs__link md-tabs__link--active">
        Tutorials
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/anatomy_language_implementation/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../background/documentation/" class="md-tabs__link">
        Background
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../release/download/" class="md-tabs__link">
        Releases
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Spoofax 3" class="md-nav__button md-logo" aria-label="Spoofax 3" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Spoofax 3
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/metaborg/spoofax-pie/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    metaborg/spoofax-pie
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installing the Spoofax 3 language workbench
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Creating a language project
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Creating a language project
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-a-new-project" class="md-nav__link">
    Creating a new project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-syntax" class="md-nav__link">
    Adding syntax
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-syntax-highlighting" class="md-nav__link">
    Changing syntax highlighting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-debugging-command" class="md-nav__link">
    Adding a debugging command
  </a>
  
    <nav class="md-nav" aria-label="Adding a debugging command">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-task-definition" class="md-nav__link">
    Creating the task definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registering-the-task-definition" class="md-nav__link">
    Registering the task definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-command" class="md-nav__link">
    Creating the command
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-the-menu-item" class="md-nav__link">
    Adding the menu item
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-the-static-semantics" class="md-nav__link">
    Changing the static semantics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-transformation" class="md-nav__link">
    Adding a transformation
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/anatomy_language_implementation/" class="md-nav__link">
        Anatomy of a language implementation
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Background
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Background" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Background
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../background/documentation/" class="md-nav__link">
        Documentation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../background/motivation/" class="md-nav__link">
        Motivation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../background/key_ideas/" class="md-nav__link">
        Key ideas
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../background/status/" class="md-nav__link">
        Current Status
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Releases
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Releases" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Releases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../release/download/" class="md-nav__link">
        Downloads
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-a-new-project" class="md-nav__link">
    Creating a new project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-syntax" class="md-nav__link">
    Adding syntax
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-syntax-highlighting" class="md-nav__link">
    Changing syntax highlighting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-debugging-command" class="md-nav__link">
    Adding a debugging command
  </a>
  
    <nav class="md-nav" aria-label="Adding a debugging command">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-task-definition" class="md-nav__link">
    Creating the task definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registering-the-task-definition" class="md-nav__link">
    Registering the task definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-command" class="md-nav__link">
    Creating the command
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-the-menu-item" class="md-nav__link">
    Adding the menu item
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-the-static-semantics" class="md-nav__link">
    Changing the static semantics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-transformation" class="md-nav__link">
    Adding a transformation
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/metaborg/spoofax-pie/edit/master/docs/tutorial/create_language_project.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="creating-a-language-project">Creating a language project<a class="headerlink" href="#creating-a-language-project" title="Permanent link">&para;</a></h1>
<p>This tutorial gets you started with language development by creating a language project and changing various aspects of the language. First follow the <a href="../install/">installation tutorial</a> if you haven't done so yet.</p>
<h2 id="creating-a-new-project">Creating a new project<a class="headerlink" href="#creating-a-new-project" title="Permanent link">&para;</a></h2>
<p>In Eclipse, open the new project dialog by choosing <span class="guilabel">File ‣ New ‣ Project</span> from the main menu.
In the new project dialog, select <span class="guilabel">Spoofax <abbr title="Language Workbench">LWB</abbr> ‣ Spoofax language project</span> and press <span class="guilabel">Next</span>.
In this wizard, you can customize the various names your language will use.
However, for the purpose of this tutorial, fill in <code>HelloWorld</code> as the name of the project, which will automatically fill in the other elements with defaults.
Then press <span class="guilabel">Finish</span> to create the project.
There should now be a project named <code>helloworld</code> in the <span class="guilabel">Package Explorer&lt;/span.</p>
<h2 id="adding-syntax">Adding syntax<a class="headerlink" href="#adding-syntax" title="Permanent link">&para;</a></h2>
<p>First we will add some syntax to the language.
Open the main SDF3 file <code>helloworld/src/start.sdf3</code> file by expanding the folders and double-clicking the file.
SDF3 is a meta-language (i.e., a language to describe languages) for describing the syntax of a language, from which Spoofax will derive the parser of your language.
Under the <code class="highlight">context-free syntax</code> section, replace the <code class="highlight">Start.Empty = &lt;&gt;</code> line with <code class="highlight">Start.Program = &lt;&lt;{Part &quot; &quot;}*&gt;&gt;</code>, indicating that the language accepts programs which consists of one or more parts.
Then add <code class="highlight">Part.Hello = &lt;hello&gt;</code> on a new line, indicating that one sort of part is the word <code>hello.</code>
Finally, add <code class="highlight">Part.World = &lt;world&gt;</code> on a new line, indicating that one sort of part is the word <code>world</code>.
The context-free syntax section should now look as follows:</p>
<div class="highlight"><pre><span></span><code>context-free syntax

  Start.Program = &lt;&lt;{Part &quot; &quot;}*&gt;&gt;
  Part.Hello = &lt;hello&gt;
  Part.World = &lt;world&gt;
</code></pre></div>
<p>To test our change, build the project by clicking on the project in the <span class="guilabel">Package Explorer</span> and choosing <span class="guilabel">Project ‣ Build Project</span> from the main menu, or by pressing <span class="keys"><kbd class="key-command">Cmd</kbd><span>+</span><kbd class="key-b">B</kbd></span> on macOS or <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-b">B</kbd></span> on others.
To see when the build is done, open the progress window by choosing <span class="guilabel">Window ‣ Show View ‣ Progress</span>.
If the progress view is empty, the build is done.
The initial build can be a bit slow because there is a lot of code to compile in the background.
Subsequent builds will be faster due to incrementalization.</p>
<p>Create a test file for your language by right-clicking the project and choosing <span class="guilabel">New ‣ File</span>, filling in <code>test.hel</code> as file name, and pressing <span class="guilabel">Finish</span>.
Type a valid sentence such as <code>hello world hello hello world</code> in this file, and it will highlight purple indicating that <code>hello</code> and <code>world</code> are keywords.
There will also be an error marker on the file because we have not yet updated the static semantics (i.e., type checker) of the language to handle the language constructs we just added.
That is ok for now, we will fix this later.</p>
<h2 id="changing-syntax-highlighting">Changing syntax highlighting<a class="headerlink" href="#changing-syntax-highlighting" title="Permanent link">&para;</a></h2>
<p>Now we will change the syntax highlighter of the language.
Open the main ESV file <code>helloworld/src/main.esv</code>.
ESV is a meta-language for describing the syntax highlighter.
Change the <code class="highlight">keyword : 127 0 85 bold</code> line to <code class="highlight">keyword: 0 0 150 bold</code> and build the project.
Then check your <code>test.hel</code> example file, it should now be highlighted blue.</p>
<p>To make iteration easier, you can drag the <code>test.hel</code> tab to the side of the screen to open the language definition and example file side-by-side.
You can play around with the coloring a bit and choose a style to your liking.
Remember to rebuild the project after making a change to the language definition.</p>
<h2 id="adding-a-debugging-command">Adding a debugging command<a class="headerlink" href="#adding-a-debugging-command" title="Permanent link">&para;</a></h2>
<p>It can be quite handy to look at the <abbr title="Abstract Syntax Tree">AST</abbr> of a program that the parser of the language produces as a debugging tool.
To do that, we will write a <em>task definition</em> that produces the <abbr title="Abstract Syntax Tree">AST</abbr> of a program by parsing it, we will add a <em>command</em> for that task, and finally we will bind the command to a <em>menu item</em> so that we can execute the command.</p>
<h3 id="creating-the-task-definition">Creating the task definition<a class="headerlink" href="#creating-the-task-definition" title="Permanent link">&para;</a></h3>
<p>A task definition is a piece of code that take some input, may read from or write to files, and produce some output.
A task definition is written as a class in Java, and needs to adhere to a certain interface.
For brevity, we usually just refer to a "task definition" by "task".</p>
<p>Let's start by creating the class for this task.
First, right-click the <code>helloworld/src/main/java</code> directory and choose <span class="guilabel">New ‣ Package</span>, replace the name with <code>mb.helloworld.task</code>, and press <span class="guilabel">Finish</span>.
Then, right-click the <code>mb.helloworld.task</code> package we just created and choose <span class="guilabel">New ‣ Class</span> and fill in <code>HelloWorldShowParsedAst</code> as name, then press <span class="guilabel">Finish</span>.
Replace the entire Java file with the following code:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">mb.helloworld.task</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.checkerframework.checker.nullness.qual.Nullable</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">mb.helloworld.HelloWorldClassLoaderResources</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.helloworld.HelloWorldScope</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.pie.api.ExecContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.pie.api.TaskDef</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.pie.api.stamp.resource.ResourceStampers</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.resource.ResourceKey</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.spoofax.core.language.command.CommandFeedback</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.spoofax.core.language.command.ShowFeedback</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.stratego.common.StrategoUtil</span><span class="p">;</span>

<span class="nd">@HelloWorldScope</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldShowParsedAst</span> <span class="kd">implements</span> <span class="n">TaskDef</span><span class="o">&lt;</span><span class="n">HelloWorldShowParsedAst</span><span class="p">.</span><span class="na">Args</span><span class="p">,</span> <span class="n">CommandFeedback</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Args</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="n">ResourceKey</span> <span class="n">file</span><span class="p">;</span>

    <span class="kd">public</span> <span class="nf">Args</span><span class="p">(</span><span class="n">ResourceKey</span> <span class="n">file</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">file</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="p">(</span><span class="nd">@Nullable</span> <span class="n">Object</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="p">()</span> <span class="o">!=</span> <span class="n">o</span><span class="p">.</span><span class="na">getClass</span><span class="p">())</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="kd">final</span> <span class="n">Args</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">Args</span><span class="p">)</span><span class="n">o</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">file</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">file</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">Objects</span><span class="p">.</span><span class="na">hash</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s">&quot;Args{&quot;</span> <span class="o">+</span> <span class="s">&quot;file=&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="sc">&#39;}&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>


  <span class="kd">private</span> <span class="kd">final</span> <span class="n">HelloWorldClassLoaderResources</span> <span class="n">classloaderResources</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">HelloWorldParse</span> <span class="n">parse</span><span class="p">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">HelloWorldShowParsedAst</span><span class="p">(</span><span class="n">HelloWorldClassLoaderResources</span> <span class="n">classloaderResources</span><span class="p">,</span> <span class="n">HelloWorldParse</span> <span class="n">parse</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">classloaderResources</span> <span class="o">=</span> <span class="n">classloaderResources</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">parse</span> <span class="o">=</span> <span class="n">parse</span><span class="p">;</span>
  <span class="p">}</span>


  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">CommandFeedback</span> <span class="nf">exec</span><span class="p">(</span><span class="n">ExecContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Args</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="n">context</span><span class="p">.</span><span class="na">require</span><span class="p">(</span><span class="n">classloaderResources</span><span class="p">.</span><span class="na">tryGetAsLocalResource</span><span class="p">(</span><span class="n">getClass</span><span class="p">()),</span> <span class="n">ResourceStampers</span><span class="p">.</span><span class="na">hashFile</span><span class="p">());</span>
    <span class="kd">final</span> <span class="n">ResourceKey</span> <span class="n">file</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="na">file</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">context</span><span class="p">.</span><span class="na">require</span><span class="p">(</span><span class="n">parse</span><span class="p">.</span><span class="na">inputBuilder</span><span class="p">().</span><span class="na">withFile</span><span class="p">(</span><span class="n">file</span><span class="p">).</span><span class="na">buildAstSupplier</span><span class="p">()).</span><span class="na">mapOrElse</span><span class="p">(</span>
        <span class="n">ast</span> <span class="o">-&gt;</span> <span class="n">CommandFeedback</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">ShowFeedback</span><span class="p">.</span><span class="na">showText</span><span class="p">(</span><span class="n">StrategoUtil</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">ast</span><span class="p">),</span> <span class="s">&quot;Parsed AST for &#39;&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)),</span>
      <span class="n">e</span> <span class="o">-&gt;</span> <span class="n">CommandFeedback</span><span class="p">.</span><span class="na">ofTryExtractMessagesFrom</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition todo">
<p class="admonition-title">Todo</p>
<p>Explain this class.</p>
</div>
<h3 id="registering-the-task-definition">Registering the task definition<a class="headerlink" href="#registering-the-task-definition" title="Permanent link">&para;</a></h3>
<p>We must register this task in order for Spoofax to know about it.
Open the CFG <code>helloworld/spoofax.cfg</code> file.
The CFG meta-language is a configuration language where we configure and glue together the various aspects of your language.
Add the following configuration to the end of the file:</p>
<div class="highlight"><pre><span></span><code><span class="na">task-defs {</span>
  <span class="na">mb.helloworld.task.HelloWorldShowParsedAst</span>
<span class="na">}</span>
</code></pre></div>
<p>This registers the task definition class that we just created.</p>
<h3 id="creating-the-command">Creating the command<a class="headerlink" href="#creating-the-command" title="Permanent link">&para;</a></h3>
<p>To create the command, add the following configuration to the end of the <code>spoofax.cfg</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="na">command-def {</span>
  <span class="na">type</span> <span class="o">=</span> <span class="s">mb.helloworld.HelloWorldShowParsedAstCommand</span>
  <span class="na">task-def-type</span> <span class="o">=</span> <span class="s">mb.helloworld.task.HelloWorldShowParsedAst</span>
  <span class="na">args-type</span> <span class="o">=</span> <span class="s">mb.helloworld.task.HelloWorldShowParsedAst.Args</span>
  <span class="na">display-name</span> <span class="o">=</span> <span class="s">&quot;Show parsed AST&quot;</span>
  <span class="na">description</span> <span class="o">=</span> <span class="s">&quot;Shows the parsed AST&quot;</span>
  <span class="na">supported-execution-types</span> <span class="o">=</span> <span class="s">ManualOnce, ManualContinuous</span>
  <span class="na">parameters</span> <span class="o">=</span> <span class="s">{</span>
    <span class="na">file</span> <span class="o">=</span> <span class="s">{</span>
      <span class="na">type</span> <span class="o">=</span> <span class="s">mb.resource.ResourceKey</span>
      <span class="na">required</span> <span class="o">=</span> <span class="s">true</span>
      <span class="na">argument-providers</span> <span class="o">=</span> <span class="s">{</span>
        <span class="na">Context(File)</span>
      <span class="na">}</span>
    <span class="na">}</span>
  <span class="na">}</span>
<span class="na">}</span>
</code></pre></div>
<div class="admonition todo">
<p class="admonition-title">Todo</p>
<p>Explain this configuration.</p>
</div>
<h3 id="adding-the-menu-item">Adding the menu item<a class="headerlink" href="#adding-the-menu-item" title="Permanent link">&para;</a></h3>
<p>To add the menu item, add the following configuration to the end of the <code>spoofax.cfg</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="na">editor-context-menu {</span>
  <span class="na">menu &quot;Debug&quot; {</span>
    <span class="na">command-action {</span>
      <span class="na">display-name</span> <span class="o">=</span> <span class="s">&quot;Show parsed AST&quot;</span>
      <span class="na">description</span> <span class="o">=</span> <span class="s">&quot;Shows the parsed AST&quot;</span>
      <span class="na">command-def-type</span> <span class="o">=</span> <span class="s">mb.helloworld.HelloWorldShowParsedAstCommand</span>
      <span class="na">execution-type</span> <span class="o">=</span> <span class="s">ManualOnce</span>
    <span class="na">}</span>
    <span class="na">command-action {</span>
      <span class="na">display-name</span> <span class="o">=</span> <span class="s">&quot;Show parsed AST (continuous)&quot;</span>
      <span class="na">description</span> <span class="o">=</span> <span class="s">&quot;Shows the parsed AST continuously&quot;</span>
      <span class="na">command-def-type</span> <span class="o">=</span> <span class="s">mb.helloworld.HelloWorldShowParsedAstCommand</span>
      <span class="na">execution-type</span> <span class="o">=</span> <span class="s">ManualContinuous</span>
    <span class="na">}</span>
  <span class="na">}</span>
<span class="na">}</span>
<span class="na">resource-context-menu {</span>
  <span class="na">menu &quot;Debug&quot; {</span>
    <span class="na">command-action {</span>
      <span class="na">display-name</span> <span class="o">=</span> <span class="s">&quot;Show parsed AST&quot;</span>
      <span class="na">description</span> <span class="o">=</span> <span class="s">&quot;Shows the parsed AST&quot;</span>
      <span class="na">command-def-type</span> <span class="o">=</span> <span class="s">mb.helloworld.HelloWorldShowParsedAstCommand</span>
      <span class="na">execution-type</span> <span class="o">=</span> <span class="s">ManualOnce</span>
      <span class="na">required-hierarchical-resource-types</span> <span class="o">=</span> <span class="s">File</span>
    <span class="na">}</span>
  <span class="na">}</span>
<span class="na">}</span>
</code></pre></div>
<div class="admonition todo">
<p class="admonition-title">Todo</p>
<p>Explain this configuration.</p>
</div>
<p>Build the project so that we can test our changes.</p>
<div class="admonition bug">
<p class="admonition-title">Bug</p>
<p>Building the project at this point will result in an error. This can be worked around by first cleaning the project by choosing <span class="guilabel">Project ‣ Clean</span> from the main menu. This bug will be fixed in a future version.</p>
</div>
<p>Let's test the command.
Open the <code>test.hel</code> file and right-click inside the editor area to open the context menu.
From the editor context menu, select <span class="guilabel">HelloWorld ‣ Debug ‣ Show parsed <abbr title="Abstract Syntax Tree">AST</abbr></span>.
A new editor will pop up with the result of the command, showing the <abbr title="Abstract Syntax Tree">AST</abbr> of your example file.
Close the result and now run <span class="guilabel">HelloWorld ‣ Debug ‣ Show parsed <abbr title="Abstract Syntax Tree">AST</abbr> (continuous)</span>.
Drag the resulting editor to the side and edit the example project, the resulting editor will update whenever the example file changes.</p>
<p>We can also run the command by activating the <code>test.hel</code> editor by choosing <span class="guilabel">Spoofax ‣ Debug ‣ Show parsed <abbr title="Abstract Syntax Tree">AST</abbr></span> from the main menu.
Finally, we can run the command by right-clicking the <code>test.hel</code> file in the <span class="guilabel">Package Explorer</span> by choosing <span class="guilabel">Spoofax ‣ Debug ‣ Show parsed <abbr title="Abstract Syntax Tree">AST</abbr></span> from the context menu.</p>
<h2 id="changing-the-static-semantics">Changing the static semantics<a class="headerlink" href="#changing-the-static-semantics" title="Permanent link">&para;</a></h2>
<p>Now we will fix the static semantics of the language.
Open the main Statix file <code>helloworld/src/main.stx</code>
Statix is a meta-language for defining the static semantics of your language, which includes type checking.</p>
<p>First we will update the Statix specification to handle the new language constructs.
Replace the <code class="highlight">signature</code> section with the following:</p>
<div class="highlight"><pre><span></span><code>signature

  sorts Start constructors
    Program : list(Part) -&gt; Start
  sorts Part constructors
    Hello : Part
    World : Part
</code></pre></div>
<p>This defines the <abbr title="Abstract Syntax Tree">AST</abbr> signature of the language.
In a future version of Spoofax 3, this will be automatically derived from the SDF3 specification.</p>
<p>Now, replace the <code class="highlight">programOk(Empty()).</code> line with <code class="highlight">programOk(Program(parts)).</code>, meaning that we accept all programs consisting of parts, which is always true due to the syntax of the language.
The file should now look like this:</p>
<div class="highlight"><pre><span></span><code>module main

signature

  sorts Start constructors
    Program : list(Part) -&gt; Start
  sorts Part constructors
    Hello : Part
    World : Part

rules

  programOk : Start
  programOk(Program(parts)).
</code></pre></div>
<p>Build the project, and the error marker should disappear from your example program.</p>
<p>As a silly rule, we will add a warning to all instances of <code>world</code> in the program.
Add the following code to the end of the Statix definition:</p>
<div class="highlight"><pre><span></span><code>  partOk : Part
  partOk(Hello()).
  partOk(World()) :- try { false } | warning $[World!].
  partsOk maps partOk(list(*))
</code></pre></div>
<p>This adds a <code class="highlight">partOk</code> rule that lets all <code class="highlight">Hello()</code> parts pass, but will add a warning to all <code class="highlight">World()</code> parts.
<code class="highlight">partsOk</code> goes over a list of parts and applies <code class="highlight">partOk</code>.
Replace the <code class="highlight">programOk(Program(parts)).</code> line with <code class="highlight">programOk(Program(parts)) :- partsOk(parts).</code> to apply the <code class="highlight">partsOk</code> rule.
Build the project, and a warning marker should appear under all instances of <code>world</code> in the program.</p>
<h2 id="adding-a-transformation">Adding a transformation<a class="headerlink" href="#adding-a-transformation" title="Permanent link">&para;</a></h2>
<p>Finally, we will define a transformation for our language and add a task, command-tasks, command, and menu item for it.
Open the main Stratego file <code>helloworld/src/main.str</code>.
Stratego is a meta-language for defining term (<abbr title="Abstract Syntax Tree">AST</abbr>) transformations through rewrite rules.
We will add a silly transformation that replaces all instances of <code class="highlight">World()</code> with <code class="highlight">Hello()</code>.</p>
<p>Add the following code to the end of the Stratego file:</p>
<div class="highlight"><pre><span></span><code>rules

  replace-world: Hello() -&gt; Hello()
  replace-world: World() -&gt; Hello()
  replace-worlds = topdown(replace-world)
</code></pre></div>
<p>The <code class="highlight">replace-world</code> rule passes <code class="highlight">Hello()</code> terms but rewrites <code class="highlight">World()</code> terms to <code class="highlight">Hello()</code>.
The <code class="highlight">replace-worlds</code> strategy applies <code class="highlight">replace-world</code> in a top-down manner over the entire <abbr title="Abstract Syntax Tree">AST</abbr>.</p>
<p>Now we add a task and command-task for this transformation.
We define two separate tasks to keep separate</p>
<ol>
<li>the act of transforming the program, and</li>
<li>feeding back the result of that transformation to the user that executes a command.</li>
</ol>
<p>This practice later allows us to reuse the first task in a different task if we need to.
Right-click the <code>mb.helloworld.task</code> package and create the <code>HelloWorldReplaceWorlds</code> class and replace the entire Java file with:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">mb.helloworld.task</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">mb.helloworld.HelloWorldClassLoaderResources</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.pie.api.ExecContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.pie.api.stamp.resource.ResourceStampers</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.stratego.pie.AstStrategoTransformTaskDef</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="nd">@HelloWorldScope</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldReplaceWorlds</span> <span class="kd">extends</span> <span class="n">AstStrategoTransformTaskDef</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">HelloWorldClassLoaderResources</span> <span class="n">classloaderResources</span><span class="p">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">HelloWorldReplaceWorlds</span><span class="p">(</span>
    <span class="n">HelloWorldClassLoaderResources</span> <span class="n">classloaderResources</span><span class="p">,</span>
    <span class="n">HelloWorldGetStrategoRuntimeProvider</span> <span class="n">getStrategoRuntimeProvider</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">(</span><span class="n">getStrategoRuntimeProvider</span><span class="p">,</span> <span class="s">&quot;replace-worlds&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="na">classloaderResources</span> <span class="o">=</span> <span class="n">classloaderResources</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@Override</span> <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nd">@Override</span> <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">createDependencies</span><span class="p">(</span><span class="n">ExecContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
    <span class="n">context</span><span class="p">.</span><span class="na">require</span><span class="p">(</span><span class="n">classloaderResources</span><span class="p">.</span><span class="na">tryGetAsLocalResource</span><span class="p">(</span><span class="n">getClass</span><span class="p">()),</span> <span class="n">ResourceStampers</span><span class="p">.</span><span class="na">hashFile</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition todo">
<p class="admonition-title">Todo</p>
<p>Explain this class.</p>
</div>
<p>Then create the <code>HelloWorldShowReplaceWorlds</code> class and replace the entire Java file with:</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">mb.helloworld.task</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.checkerframework.checker.nullness.qual.Nullable</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">mb.helloworld.HelloWorldClassLoaderResources</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.helloworld.HelloWorldScope</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.pie.api.ExecContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.pie.api.TaskDef</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.pie.api.stamp.resource.ResourceStampers</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.resource.ResourceKey</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.spoofax.core.language.command.CommandFeedback</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.spoofax.core.language.command.ShowFeedback</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">mb.stratego.common.StrategoUtil</span><span class="p">;</span>

<span class="nd">@HelloWorldScope</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldShowReplaceWorlds</span> <span class="kd">implements</span> <span class="n">TaskDef</span><span class="o">&lt;</span><span class="n">HelloWorldShowReplaceWorlds</span><span class="p">.</span><span class="na">Args</span><span class="p">,</span> <span class="n">CommandFeedback</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Args</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>

        <span class="kd">public</span> <span class="kd">final</span> <span class="n">ResourceKey</span> <span class="n">file</span><span class="p">;</span>

        <span class="kd">public</span> <span class="nf">Args</span><span class="p">(</span><span class="n">ResourceKey</span> <span class="n">file</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">file</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="p">(</span><span class="nd">@Nullable</span> <span class="n">Object</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="p">()</span> <span class="o">!=</span> <span class="n">o</span><span class="p">.</span><span class="na">getClass</span><span class="p">())</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="kd">final</span> <span class="n">Args</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">Args</span><span class="p">)</span> <span class="n">o</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">file</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">file</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">Objects</span><span class="p">.</span><span class="na">hash</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">&quot;Args{&quot;</span> <span class="o">+</span> <span class="s">&quot;file=&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="sc">&#39;}&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="kd">private</span> <span class="kd">final</span> <span class="n">HelloWorldClassLoaderResources</span> <span class="n">classloaderResources</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">HelloWorldParse</span> <span class="n">parse</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">HelloWorldReplaceWorlds</span> <span class="n">replaceWorlds</span><span class="p">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">public</span> <span class="nf">HelloWorldShowReplaceWorlds</span><span class="p">(</span><span class="n">HelloWorldClassLoaderResources</span> <span class="n">classloaderResources</span><span class="p">,</span> <span class="n">HelloWorldParse</span> <span class="n">parse</span><span class="p">,</span> <span class="n">HelloWorldReplaceWorlds</span> <span class="n">replaceWorlds</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">classloaderResources</span> <span class="o">=</span> <span class="n">classloaderResources</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">parse</span> <span class="o">=</span> <span class="n">parse</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">replaceWorlds</span> <span class="o">=</span> <span class="n">replaceWorlds</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">CommandFeedback</span> <span class="nf">exec</span><span class="p">(</span><span class="n">ExecContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">Args</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">context</span><span class="p">.</span><span class="na">require</span><span class="p">(</span><span class="n">classloaderResources</span><span class="p">.</span><span class="na">tryGetAsLocalResource</span><span class="p">(</span><span class="n">getClass</span><span class="p">()),</span> <span class="n">ResourceStampers</span><span class="p">.</span><span class="na">hashFile</span><span class="p">());</span>
        <span class="kd">final</span> <span class="n">ResourceKey</span> <span class="n">file</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="na">file</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">context</span><span class="p">.</span><span class="na">require</span><span class="p">(</span><span class="n">replaceWorlds</span><span class="p">,</span> <span class="n">parse</span><span class="p">.</span><span class="na">inputBuilder</span><span class="p">().</span><span class="na">withFile</span><span class="p">(</span><span class="n">file</span><span class="p">).</span><span class="na">buildAstSupplier</span><span class="p">()).</span><span class="na">mapOrElse</span><span class="p">(</span>
            <span class="n">ast</span> <span class="o">-&gt;</span> <span class="n">CommandFeedback</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">ShowFeedback</span><span class="p">.</span><span class="na">showText</span><span class="p">(</span><span class="n">StrategoUtil</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">ast</span><span class="p">),</span> <span class="s">&quot;Replaced World()s with Hello()s for &#39;&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)),</span>
            <span class="n">e</span> <span class="o">-&gt;</span> <span class="n">CommandFeedback</span><span class="p">.</span><span class="na">ofTryExtractMessagesFrom</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This class very similar to <code>HelloWorldShowParsedAst</code>, but runs the <code>HelloWorldReplaceWorlds</code> task on the parsed <abbr title="Abstract Syntax Tree">AST</abbr>, transforming the <abbr title="Abstract Syntax Tree">AST</abbr>.</p>
<p>Now open <code>helloworld/spoofax.cfg</code> again and register the tasks by adding:</p>
<div class="highlight"><pre><span></span><code><span class="na">task-defs {</span>
  <span class="na">mb.helloworld.task.HelloWorldReplaceWorlds</span>
  <span class="na">mb.helloworld.task.HelloWorldShowReplaceWorlds</span>
<span class="na">}</span>
</code></pre></div>
<p>Then add a command for it by adding:</p>
<div class="highlight"><pre><span></span><code><span class="na">command-def {</span>
  <span class="na">type</span> <span class="o">=</span> <span class="s">mb.helloworld.HelloWorldShowReplaceWorldsCommand</span>
  <span class="na">task-def-type</span> <span class="o">=</span> <span class="s">mb.helloworld.task.HelloWorldShowReplaceWorlds</span>
  <span class="na">args-type</span> <span class="o">=</span> <span class="s">mb.helloworld.task.HelloWorldShowReplaceWorlds.Args</span>
  <span class="na">display-name</span> <span class="o">=</span> <span class="s">&quot;Show parsed AST&quot;</span>
  <span class="na">description</span> <span class="o">=</span> <span class="s">&quot;Shows the parsed AST&quot;</span>
  <span class="na">supported-execution-types</span> <span class="o">=</span> <span class="s">ManualOnce, ManualContinuous</span>
  <span class="na">parameters</span> <span class="o">=</span> <span class="s">{</span>
    <span class="na">file</span> <span class="o">=</span> <span class="s">{</span>
      <span class="na">type</span> <span class="o">=</span> <span class="s">mb.resource.ResourceKey</span>
      <span class="na">required</span> <span class="o">=</span> <span class="s">true</span>
      <span class="na">argument-providers</span> <span class="o">=</span> <span class="s">{</span>
        <span class="na">Context(File)</span>
      <span class="na">}</span>
    <span class="na">}</span>
  <span class="na">}</span>
<span class="na">}</span>
</code></pre></div>
<div class="admonition bug">
<p class="admonition-title">Bug</p>
<p>The command definition will have several warnings noting "Option ignored because it was defined before", because the command is merged with the previous command, breaking the entire command. This can be worked around by commenting out the command and menu added earlier and cleaning with <span class="guilabel">Project ‣ Clean</span>. This will be fixed in a future version.</p>
</div>
<p>Finally, add menu items for the command by adding:</p>
<div class="highlight"><pre><span></span><code><span class="na">editor-context-menu {</span>
  <span class="na">menu &quot;Debug&quot; {</span>
    <span class="na">command-action {</span>
      <span class="na">display-name</span> <span class="o">=</span> <span class="s">&quot;Show result of replace worlds transformation&quot;</span>
      <span class="na">description</span> <span class="o">=</span> <span class="s">&quot;Shows the resulting AST of the replace world transformation&quot;</span>
      <span class="na">command-def-type</span> <span class="o">=</span> <span class="s">mb.helloworld.HelloWorldShowReplaceWorldsCommand</span>
      <span class="na">execution-type</span> <span class="o">=</span> <span class="s">ManualOnce</span>
    <span class="na">}</span>
    <span class="na">command-action {</span>
      <span class="na">display-name</span> <span class="o">=</span> <span class="s">&quot;Show result of replace worlds transformation (continuous)&quot;</span>
      <span class="na">description</span> <span class="o">=</span> <span class="s">&quot;Shows the resulting AST of the replace world transformation continuously&quot;</span>
      <span class="na">command-def-type</span> <span class="o">=</span> <span class="s">mb.helloworld.HelloWorldShowReplaceWorldsCommand</span>
      <span class="na">execution-type</span> <span class="o">=</span> <span class="s">ManualContinuous</span>
    <span class="na">}</span>
  <span class="na">}</span>
<span class="na">}</span>
<span class="na">resource-context-menu {</span>
  <span class="na">menu &quot;Debug&quot; {</span>
    <span class="na">command-action {</span>
      <span class="na">display-name</span> <span class="o">=</span> <span class="s">&quot;Show result of replace worlds transformation&quot;</span>
      <span class="na">description</span> <span class="o">=</span> <span class="s">&quot;Shows the resulting AST of the replace world transformation&quot;</span>
      <span class="na">command-def-type</span> <span class="o">=</span> <span class="s">mb.helloworld.HelloWorldShowReplaceWorldsCommand</span>
      <span class="na">execution-type</span> <span class="o">=</span> <span class="s">ManualOnce</span>
      <span class="na">required-hierarchical-resource-types</span> <span class="o">=</span> <span class="s">File</span>
    <span class="na">}</span>
  <span class="na">}</span>
<span class="na">}</span>
</code></pre></div>
<p>Build the project so that we can test our changes.</p>
<div class="admonition bug">
<p class="admonition-title">Bug</p>
<p>Building the project at this point will result in an error. This can be worked around by first cleaning the project by choosing <span class="guilabel">Project ‣ Clean</span> from the main menu. This bug will be fixed in a future version.</p>
</div>
<p>Test the command similarly to testing the "Show parsed <abbr title="Abstract Syntax Tree">AST</abbr>" command.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" title="Back to top" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../install/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Installing the Spoofax 3 language workbench
            </div>
          </div>
        </a>
      
      
        <a href="../../reference/anatomy_language_implementation/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Anatomy of a language implementation
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
    
  </body>
</html>